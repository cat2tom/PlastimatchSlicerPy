import vtkSlicerPlastimatchModuleLogicPython
reg = vtkSlicerPlastimatchModuleLogicPython.vtkSlicerPlastimatchLogic()

reg.SetMRMLScene(slicer.mrmlScene)

img_fixed = "Img1" 
img_moving = "Img2"
xf_in = "LinearTransformation"

reg.SetFixedId(getNode(img_fixed).GetID())
reg.SetMovingId(getNode(img_moving).GetID())
reg.SetInputXfId(getNode(xf_in).GetID())
reg.SetOutputImageName("OutputImg")

reg.SetFixedLandmarksFn("fixed_landmarks.fcsv")
reg.SetMovingLandmarksFn("moving_landmarks.fcsv")

reg.AddStage()
reg.SetPar("xform", "bspline")
reg.SetPar("optim", "lbfgsb")
reg.SetPar("impl", "plastimatch")
reg.SetPar("metric", "mse")
reg.SetPar("max_its", "150")
reg.SetPar("convergence_tol", "5")
reg.SetPar("grad_tol", "1.5")
reg.SetPar("res", "4 4 2")
reg.SetPar("grid_spac", "80 80 80")

reg.RunRegistration()
